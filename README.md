# RabbitMQ Spring Boot å¼‚æ­¥ç¡®è®¤ç¤ºä¾‹

è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„ Spring Boot + RabbitMQ ç¤ºä¾‹é¡¹ç›®ï¼Œå±•ç¤ºäº† **Publisher å¼‚æ­¥ç¡®è®¤** å’Œ **Consumer å¼‚æ­¥ç¡®è®¤** çš„å®ç°ã€‚

## ğŸ“‹ ç›®å½•

- [åŠŸèƒ½ç‰¹æ€§](#åŠŸèƒ½ç‰¹æ€§)
- [æ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡)
- [æŠ€æœ¯æ ˆ](#æŠ€æœ¯æ ˆ)
- [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
- [ç¯å¢ƒå‡†å¤‡](#ç¯å¢ƒå‡†å¤‡)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [æ ¸å¿ƒåŠŸèƒ½è¯´æ˜](#æ ¸å¿ƒåŠŸèƒ½è¯´æ˜)
- [API æ¥å£](#api-æ¥å£)
- [æµ‹è¯•åœºæ™¯](#æµ‹è¯•åœºæ™¯)
- [é…ç½®è¯´æ˜](#é…ç½®è¯´æ˜)

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### 1. Publisher å¼‚æ­¥ç¡®è®¤

- âœ… **ConfirmCallback**ï¼šæ¶ˆæ¯åˆ°è¾¾ Exchange æ—¶å¼‚æ­¥æ¥æ”¶ç¡®è®¤
- âœ… **ReturnCallback**ï¼šæ¶ˆæ¯æ— æ³•è·¯ç”±åˆ°é˜Ÿåˆ—æ—¶æ¥æ”¶å›è°ƒ
- âœ… **CorrelationData**ï¼šä½¿ç”¨å…³è”æ•°æ®è·Ÿè¸ªæ¯æ¡æ¶ˆæ¯çš„ç¡®è®¤çŠ¶æ€
- âœ… **æ‰¹é‡å‘é€**ï¼šæ”¯æŒæ‰¹é‡å‘é€æ¶ˆæ¯å¹¶å¼‚æ­¥æ¥æ”¶ç¡®è®¤
- âœ… **è‡ªåŠ¨é‡è¯•æœºåˆ¶** ğŸ”¥ï¼šä½¿ç”¨ Spring Retry è‡ªåŠ¨å¤„ç†ä¸´æ—¶ç½‘ç»œé—®é¢˜ï¼ˆ3æ¬¡é‡è¯•ï¼ŒæŒ‡æ•°é€€é¿ï¼‰

### 2. Consumer å¼‚æ­¥ç¡®è®¤

- âœ… **æ‰‹åŠ¨ç¡®è®¤æ¨¡å¼**ï¼š`acknowledge-mode: manual`
- âœ… **å¼‚æ­¥å¤„ç†**ï¼šä½¿ç”¨ `CompletableFuture` å¼‚æ­¥å¤„ç†æ¶ˆæ¯
- âœ… **basicAck**ï¼šæ¶ˆæ¯å¤„ç†æˆåŠŸåæ‰‹åŠ¨ç¡®è®¤
- âœ… **basicNack**ï¼šæ¶ˆæ¯å¤„ç†å¤±è´¥æ—¶æ‹’ç»æ¶ˆæ¯ï¼ˆæ”¯æŒé‡æ–°å…¥é˜Ÿï¼‰
- âœ… **æµé‡æ§åˆ¶**ï¼šé€šè¿‡ `prefetch` æ§åˆ¶æ¶ˆè´¹é€Ÿç‡

### 3. æ¶ˆæ¯å¤±è´¥å¤„ç†æœºåˆ¶ ğŸ”¥ 

- âœ… **ä¸‰å±‚é˜²æŠ¤æœºåˆ¶**ï¼šConfirm å›è°ƒ â†’ Return å›è°ƒ â†’ Alternate Exchange
- âœ… **å¤±è´¥æ¶ˆæ¯æŒä¹…åŒ–**ï¼šè‡ªåŠ¨ä¿å­˜è·¯ç”±å¤±è´¥å’Œå‘é€å¤±è´¥çš„æ¶ˆæ¯
- âœ… **å¤±è´¥æ¶ˆæ¯ç®¡ç†**ï¼šå®Œæ•´çš„ REST APIï¼ˆæŸ¥è¯¢ã€é‡è¯•ã€äººå·¥å¤„ç†ï¼‰
- âœ… **Alternate Exchange**ï¼šRabbitMQ å±‚é¢è‡ªåŠ¨å¤‡ä»½è·¯ç”±å¤±è´¥çš„æ¶ˆæ¯
- âœ… **å‘Šè­¦æœºåˆ¶**ï¼šå¤±è´¥æ¶ˆæ¯è‡ªåŠ¨å‘Šè­¦ï¼ˆå¯é›†æˆé’‰é’‰/ä¼ä¸šå¾®ä¿¡ï¼‰
- âœ… **é‡è¯•æœºåˆ¶**ï¼šæ”¯æŒæ‰‹åŠ¨é‡è¯•å’Œæ‰¹é‡é‡è¯•
- âœ… **çŠ¶æ€ç®¡ç†**ï¼šPENDING â†’ RETRYING â†’ SUCCESS/EXHAUSTED
- âœ… **ç»Ÿè®¡åˆ†æ**ï¼šå¤±è´¥æ¶ˆæ¯ç»Ÿè®¡å’Œç›‘æ§

### 4. ç”Ÿäº§çº§ç‰¹æ€§ ğŸš€

- âœ… **æ­»ä¿¡é˜Ÿåˆ—ï¼ˆDLXï¼‰**ï¼šè‡ªåŠ¨å¤„ç†å¤±è´¥æ¶ˆæ¯
- âœ… **å»¶è¿Ÿé‡è¯•é˜Ÿåˆ—**ï¼šæ”¯æŒæ¶ˆæ¯è‡ªåŠ¨é‡è¯•ï¼ˆå¯é…ç½®é‡è¯•æ¬¡æ•°å’Œå»¶è¿Ÿæ—¶é—´ï¼‰
- âœ… **æ¶ˆæ¯å¹‚ç­‰æ€§**ï¼šä½¿ç”¨ç¼“å­˜é˜²æ­¢é‡å¤æ¶ˆè´¹
- âœ… **è¿æ¥æ± ä¼˜åŒ–**ï¼šChannel ç¼“å­˜å’Œè¿æ¥å¤ç”¨
- âœ… **ä¼˜é›…å…³é—­**ï¼šç¡®ä¿æ¶ˆæ¯ä¸ä¸¢å¤±
- âœ… **å®Œå–„çš„å¼‚å¸¸å¤„ç†**ï¼šå¤šå±‚æ¬¡é”™è¯¯å¤„ç†æœºåˆ¶
- âœ… **å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•**ï¼šå®Œæ•´çš„æµ‹è¯•è¦†ç›–

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          åº”ç”¨å±‚ (Spring Boot)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   REST API   â”‚         â”‚  Publisher   â”‚       â”‚   Consumer     â”‚ â”‚
â”‚  â”‚  Controller  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   (å‘é€è€…)   â”‚       â”‚   (æ¶ˆè´¹è€…)     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                  â”‚                         â”‚         â”‚
â”‚                                  â”‚                         â”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚                         â”‚
                                   â–¼                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       RabbitMQ Broker                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    ä¸»ä¸šåŠ¡äº¤æ¢æœº                               â”‚  â”‚
â”‚  â”‚                  (demo.exchange)                              â”‚  â”‚
â”‚  â”‚              [é…ç½® Alternate Exchange]                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚ æˆåŠŸè·¯ç”±                    è·¯ç”±å¤±è´¥â”‚                       â”‚
â”‚         â–¼                                   â–¼                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ ä¸»ä¸šåŠ¡é˜Ÿåˆ—   â”‚                    â”‚  å¤‡ç”¨äº¤æ¢æœº     â”‚             â”‚
â”‚  â”‚demo.queue   â”‚                    â”‚alternate.ex    â”‚             â”‚
â”‚  â”‚[é…ç½®DLX]    â”‚                    â”‚  (Fanout)      â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚        â”‚                                    â”‚                       â”‚
â”‚        â”‚ æ¶ˆæ¯å¤„ç†å¤±è´¥                        â–¼                       â”‚
â”‚        â”‚ (basicNack)              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚        â”‚                          â”‚ æœªè·¯ç”±æ¶ˆæ¯é˜Ÿåˆ—    â”‚             â”‚
â”‚        â–¼                          â”‚unrouted.queue    â”‚             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚  â”‚ æ­»ä¿¡äº¤æ¢æœº   â”‚                           â”‚                       â”‚
â”‚  â”‚dlx.exchange â”‚                           â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚                       â”‚
â”‚        â”‚                                    â”‚                       â”‚
â”‚        â–¼                                    â”‚                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚                       â”‚
â”‚  â”‚ æ­»ä¿¡é˜Ÿåˆ—     â”‚      â”‚ å»¶è¿Ÿé‡è¯•é˜Ÿåˆ—  â”‚    â”‚                       â”‚
â”‚  â”‚ dlx.queue   â”‚      â”‚ retry.queue  â”‚    â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚                       â”‚
â”‚                                            â”‚                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
                                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å¤±è´¥æ¶ˆæ¯å¤„ç†å±‚                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚            MessageFailureService (ç»Ÿä¸€ç®¡ç†)                 â”‚    â”‚
â”‚  â”‚     - å‘é€å¤±è´¥ï¼ˆPUBLISHï¼‰: è·¯ç”±å¤±è´¥ã€Confirmå¤±è´¥            â”‚    â”‚
â”‚  â”‚     - æ¶ˆè´¹å¤±è´¥ï¼ˆCONSUMEï¼‰: ä¸šåŠ¡å¤±è´¥ã€æ­»ä¿¡æ¶ˆæ¯               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚         UnroutedMessageConsumer                             â”‚    â”‚
â”‚  â”‚       (å¤„ç†ä» Alternate Exchange æ¥çš„æ¶ˆæ¯)                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¶ˆæ¯æµè½¬è¿‡ç¨‹

#### 1ï¸âƒ£ æ­£å¸¸æµç¨‹
```
å‘é€æ¶ˆæ¯ â†’ Confirmå›è°ƒ(ACK) â†’ è·¯ç”±åˆ°é˜Ÿåˆ— â†’ Consumeræ¶ˆè´¹ â†’ basicAck â†’ å®Œæˆ
```

#### 2ï¸âƒ£ è·¯ç”±å¤±è´¥æµç¨‹ï¼ˆä¸‰å±‚é˜²æŠ¤ï¼‰
```
å‘é€æ¶ˆæ¯ â†’ Confirmå›è°ƒ(ACK) â†’ è·¯ç”±å¤±è´¥
    â†“
Layer 1: Return å›è°ƒ
    â”œâ”€ è®°å½•æ—¥å¿—
    â”œâ”€ æŒä¹…åŒ–åˆ° MessageFailureService
    â””â”€ å‘é€å‘Šè­¦
    â†“
Layer 2: Alternate Exchange
    â”œâ”€ RabbitMQ è‡ªåŠ¨è½¬å‘
    â””â”€ è·¯ç”±åˆ° unrouted.messages.queue
    â†“
Layer 3: UnroutedMessageConsumer
    â”œâ”€ æ¶ˆè´¹å¤„ç†
    â”œâ”€ åˆ†æåŸå› 
    â””â”€ å°è¯•ä¿®å¤æˆ–äººå·¥ä»‹å…¥
```

#### 3ï¸âƒ£ æ¶ˆè´¹å¤±è´¥æµç¨‹
```
Consumeræ¶ˆè´¹ â†’ å¤„ç†å¤±è´¥ â†’ basicNack(requeue=false)
    â†“
æ­»ä¿¡äº¤æ¢æœº (DLX)
    â†“
æ­»ä¿¡é˜Ÿåˆ— (dlx.queue)
    â†“
DeadLetterQueueConsumer å¤„ç†
    â”œâ”€ è®°å½•æ—¥å¿—
    â”œâ”€ æŒä¹…åŒ–åˆ° MessageFailureService (failureStage=CONSUME)
    â”œâ”€ åˆ†æåŸå› 
    â””â”€ äººå·¥ä»‹å…¥æˆ–é‡è¯•
```

#### 4ï¸âƒ£ å»¶è¿Ÿé‡è¯•æµç¨‹
```
Consumeræ¶ˆè´¹ â†’ éœ€è¦é‡è¯• â†’ å‘é€åˆ°å»¶è¿Ÿé‡è¯•é˜Ÿåˆ—
    â†“
ç­‰å¾… TTL è¿‡æœŸï¼ˆ5ç§’ï¼‰
    â†“
è‡ªåŠ¨è½¬å‘å›ä¸»ä¸šåŠ¡é˜Ÿåˆ—
    â†“
é‡æ–°æ¶ˆè´¹
```

### æ ¸å¿ƒç»„ä»¶è¯´æ˜

#### Publisherï¼ˆæ¶ˆæ¯å‘å¸ƒè€…ï¼‰
- **MessagePublisher.java**
- èŒè´£ï¼šå‘é€æ¶ˆæ¯ã€æ¥æ”¶ç¡®è®¤å›è°ƒ
- ç‰¹æ€§ï¼š
  - Publisher Confirm å¼‚æ­¥ç¡®è®¤
  - Return å›è°ƒå¤„ç†è·¯ç”±å¤±è´¥
  - å¤±è´¥æ¶ˆæ¯æŒä¹…åŒ–
  - å‘Šè­¦é€šçŸ¥

#### Consumerï¼ˆæ¶ˆæ¯æ¶ˆè´¹è€…ï¼‰
- **ProductionMessageConsumer.java** - ä¸»ä¸šåŠ¡æ¶ˆè´¹è€…
- **DeadLetterQueueConsumer.java** - æ­»ä¿¡é˜Ÿåˆ—æ¶ˆè´¹è€…
- **UnroutedMessageConsumer.java** - æœªè·¯ç”±æ¶ˆæ¯æ¶ˆè´¹è€…
- èŒè´£ï¼šæ¶ˆè´¹æ¶ˆæ¯ã€æ‰‹åŠ¨ç¡®è®¤ã€å¼‚å¸¸å¤„ç†
- ç‰¹æ€§ï¼š
  - æ‰‹åŠ¨ç¡®è®¤æ¨¡å¼
  - å¹‚ç­‰æ€§ä¿è¯
  - é‡è¯•æœºåˆ¶
  - å¼‚å¸¸é™çº§

#### å¤±è´¥æ¶ˆæ¯ç®¡ç†
- **MessageFailureService.java**
- èŒè´£ï¼šå¤±è´¥æ¶ˆæ¯æŒä¹…åŒ–ã€é‡è¯•ç®¡ç†ã€ç»Ÿè®¡åˆ†æ
- åŠŸèƒ½ï¼š
  - ä¿å­˜å¤±è´¥æ¶ˆæ¯ï¼ˆROUTING_FAILEDã€CONFIRM_FAILEDï¼‰
  - çŠ¶æ€ç®¡ç†ï¼ˆPENDING â†’ RETRYING â†’ SUCCESS/EXHAUSTEDï¼‰
  - æ‰¹é‡é‡è¯•
  - äººå·¥å¤„ç†

#### é…ç½®ç®¡ç†
- **RabbitMQConfig.java** - é˜Ÿåˆ—ã€äº¤æ¢æœºã€ç»‘å®šé…ç½®
- **RabbitMQConnectionConfig.java** - è¿æ¥æ± ã€æ€§èƒ½ä¼˜åŒ–
- ç‰¹æ€§ï¼š
  - ä¸»ä¸šåŠ¡é˜Ÿåˆ—é…ç½®ï¼ˆå« DLXï¼‰
  - æ­»ä¿¡é˜Ÿåˆ—é…ç½®
  - å»¶è¿Ÿé‡è¯•é˜Ÿåˆ—é…ç½®
  - Alternate Exchange é…ç½®

### å¯é æ€§ä¿è¯æœºåˆ¶

#### 1. æ¶ˆæ¯ä¸ä¸¢å¤±
- âœ… Publisher Confirmï¼šç¡®ä¿æ¶ˆæ¯åˆ°è¾¾ Broker
- âœ… æŒä¹…åŒ–ï¼šæ¶ˆæ¯ã€é˜Ÿåˆ—ã€äº¤æ¢æœºéƒ½æŒä¹…åŒ–
- âœ… æ‰‹åŠ¨ç¡®è®¤ï¼šæ¶ˆè´¹æˆåŠŸåæ‰ç¡®è®¤
- âœ… æ­»ä¿¡é˜Ÿåˆ—ï¼šå¤„ç†å¤±è´¥çš„æ¶ˆæ¯ä¸ä¸¢å¤±

#### 2. æ¶ˆæ¯ä¸é‡å¤
- âœ… æ¶ˆæ¯ IDï¼šæ¯æ¡æ¶ˆæ¯å”¯ä¸€æ ‡è¯†
- âœ… å¹‚ç­‰æ€§æ£€æŸ¥ï¼šMessageIdempotentService
- âœ… ç¼“å­˜å»é‡ï¼šGuava Cache

#### 3. æ¶ˆæ¯æœ‰åºæ€§
- âœ… Prefetch=1ï¼šå•çº¿ç¨‹é¡ºåºå¤„ç†
- âœ… å•ä¸ª Consumerï¼šä¿è¯åŒä¸€é˜Ÿåˆ—æœ‰åº

#### 4. æ•…éšœæ¢å¤
- âœ… è‡ªåŠ¨é‡è¿ï¼šSpring AMQP è‡ªåŠ¨é‡è¿æœºåˆ¶
- âœ… æ¶ˆæ¯å¤‡ä»½ï¼šAlternate Exchange è‡ªåŠ¨å¤‡ä»½
- âœ… é™çº§ç­–ç•¥ï¼šå¤šç§å¤±è´¥å¤„ç†æ–¹æ¡ˆ

### æ€§èƒ½ä¼˜åŒ–

#### 1. è¿æ¥æ± ä¼˜åŒ–
```yaml
spring:
  rabbitmq:
    cache:
      channel:
        size: 25          # Channel ç¼“å­˜å¤§å°
        checkout-timeout: 0
      connection:
        mode: channel     # è¿æ¥æ¨¡å¼
```

#### 2. å¹¶å‘å¤„ç†
```yaml
listener:
  simple:
    concurrency: 3        # æœ€å°å¹¶å‘æ¶ˆè´¹è€…
    max-concurrency: 10   # æœ€å¤§å¹¶å‘æ¶ˆè´¹è€…
    prefetch: 1          # é¢„å–æ•°é‡
```

#### 3. æ‰¹é‡æ“ä½œ
- æ‰¹é‡å‘é€æ¶ˆæ¯
- æ‰¹é‡é‡è¯•å¤±è´¥æ¶ˆæ¯
- æ‰¹é‡ç¡®è®¤

### ç›‘æ§æŒ‡æ ‡

#### åº”ç”¨å±‚ç›‘æ§
- æ¶ˆæ¯å‘é€æˆåŠŸç‡
- æ¶ˆæ¯æ¶ˆè´¹æˆåŠŸç‡
- å¤±è´¥æ¶ˆæ¯æ•°é‡
- é‡è¯•æˆåŠŸç‡
- å¹³å‡å¤„ç†æ—¶é—´

#### RabbitMQ ç›‘æ§
- é˜Ÿåˆ—æ·±åº¦
- æ¶ˆæ¯é€Ÿç‡
- è¿æ¥æ•°/é€šé“æ•°
- å†…å­˜ä½¿ç”¨ç‡
- ç£ç›˜ä½¿ç”¨ç‡

#### å¤±è´¥æ¶ˆæ¯ç›‘æ§
- å¾…å¤„ç†æ¶ˆæ¯æ•° (PENDING)
- é‡è¯•ä¸­æ¶ˆæ¯æ•° (RETRYING)
- é‡è¯•è€—å°½æ¶ˆæ¯æ•° (RETRY_EXHAUSTED)
- æˆåŠŸå¤„ç†æ¶ˆæ¯æ•° (RETRY_SUCCESS)

## ğŸ›  æŠ€æœ¯æ ˆ

- **Spring Boot**: 3.2.0
- **Spring AMQP**: RabbitMQ é›†æˆ
- **Spring Retry**: è‡ªåŠ¨é‡è¯•æœºåˆ¶
- **Java**: 17
- **Lombok**: ç®€åŒ–ä»£ç 
- **Maven**: ä¾èµ–ç®¡ç†
- **Guava**: æœ¬åœ°ç¼“å­˜ï¼ˆå¹‚ç­‰æ€§ï¼‰
- **Spring Boot Actuator**: å¥åº·æ£€æŸ¥å’Œç›‘æ§

## ğŸ“ é¡¹ç›®ç»“æ„

```
rabbitmq-spring/
â”œâ”€â”€ src/main/java/com/example/rabbitmq/
â”‚   â”œâ”€â”€ RabbitMQApplication.java                  # ä¸»ç¨‹åºå…¥å£
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ RabbitMQConfig.java                   # RabbitMQ é…ç½®ï¼ˆåŒ…å« Alternate Exchangeï¼‰
â”‚   â”‚   â””â”€â”€ RabbitMQConnectionConfig.java         # è¿æ¥æ± å’Œæ€§èƒ½é…ç½®
â”‚   â”œâ”€â”€ publisher/
â”‚   â”‚   â””â”€â”€ MessagePublisher.java                 # æ¶ˆæ¯å‘å¸ƒè€…ï¼ˆå¢å¼ºç‰ˆï¼šå¤±è´¥å¤„ç†ï¼‰
â”‚   â”œâ”€â”€ consumer/
â”‚   â”‚   â”œâ”€â”€ ProductionMessageConsumer.java        # ç”Ÿäº§çº§æ¶ˆè´¹è€…ï¼ˆå®Œæ•´ç‰¹æ€§ï¼‰
â”‚   â”‚   â”œâ”€â”€ DeadLetterQueueConsumer.java          # æ­»ä¿¡é˜Ÿåˆ—æ¶ˆè´¹è€…
â”‚   â”‚   â””â”€â”€ UnroutedMessageConsumer.java          # æœªè·¯ç”±æ¶ˆæ¯æ¶ˆè´¹è€…ï¼ˆNEWï¼‰
â”‚   â”œâ”€â”€ service/
â”‚   â”‚   â”œâ”€â”€ MessageIdempotentService.java         # æ¶ˆæ¯å¹‚ç­‰æ€§æœåŠ¡
â”‚   â”‚   â””â”€â”€ MessageFailureService.java            # å¤±è´¥æ¶ˆæ¯ç®¡ç†æœåŠ¡ï¼ˆNEWï¼‰
â”‚   â”œâ”€â”€ controller/
â”‚   â”‚   â””â”€â”€ MessageController.java                # REST API æ§åˆ¶å™¨ï¼ˆå¢å¼ºç‰ˆï¼‰
â”‚   â””â”€â”€ model/
â”‚       â””â”€â”€ Message.java                          # æ¶ˆæ¯å®ä½“ç±»
â”œâ”€â”€ src/main/resources/
â”‚   â”œâ”€â”€ application.yml                           # é»˜è®¤é…ç½®
â”‚   â”œâ”€â”€ application-dev.yml                       # å¼€å‘ç¯å¢ƒé…ç½®
â”‚   â””â”€â”€ application-prod.yml                      # ç”Ÿäº§ç¯å¢ƒé…ç½®
â”œâ”€â”€ src/test/                                     # æµ‹è¯•ä»£ç 
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ MESSAGE_FAILURE_HANDLING.md               # æ¶ˆæ¯å¤±è´¥å¤„ç†è¯¦ç»†æ–‡æ¡£ï¼ˆNEWï¼‰
â”‚   â””â”€â”€ CONFIG_STRUCTURE.md                       # é…ç½®è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ pom.xml                                       # Maven é…ç½®
â”œâ”€â”€ README.md                                     # é¡¹ç›®è¯´æ˜æ–‡æ¡£ï¼ˆæœ¬æ–‡æ¡£ï¼‰
â”œâ”€â”€ ARCHITECTURE.md                               # æ¶æ„è®¾è®¡æ–‡æ¡£
â”œâ”€â”€ PRODUCTION.md                                 # ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æŒ‡å—
â””â”€â”€ QUICKSTART.md                                 # å¿«é€Ÿå¼€å§‹æŒ‡å—
```

## ğŸš€ ç¯å¢ƒå‡†å¤‡

### 1. å®‰è£… RabbitMQ

**ä½¿ç”¨ Docker å¿«é€Ÿå¯åŠ¨ï¼ˆæ¨èï¼‰ï¼š**

```bash
docker run -d --name rabbitmq \
  -p 5672:5672 \
  -p 15672:15672 \
  -e RABBITMQ_DEFAULT_USER=guest \
  -e RABBITMQ_DEFAULT_PASS=guest \
  rabbitmq:3-management
```

**æˆ–è€…ä½¿ç”¨ Homebrewï¼ˆmacOSï¼‰ï¼š**

```bash
brew install rabbitmq
brew services start rabbitmq
```

### 2. è®¿é—® RabbitMQ ç®¡ç†ç•Œé¢

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼šhttp://localhost:15672

- ç”¨æˆ·åï¼š`guest`
- å¯†ç ï¼š`guest`

## ğŸƒ å¿«é€Ÿå¼€å§‹

### 1. å…‹éš†æˆ–ä¸‹è½½é¡¹ç›®

```bash
cd /Users/cuixin/work/rabbitmq-spring
```

### 2. ç¼–è¯‘é¡¹ç›®

```bash
mvn clean package
```

### 3. å¯åŠ¨åº”ç”¨

```bash
mvn spring-boot:run
```

æˆ–è€…è¿è¡Œç¼–è¯‘åçš„ JARï¼š

```bash
java -jar target/rabbitmq-spring-1.0.0.jar
```

### 4. éªŒè¯å¯åŠ¨

```bash
curl http://localhost:8080/api/messages/health
```

åº”è¯¥è¿”å›ï¼š`RabbitMQ Service is running!`

## ğŸ” æ ¸å¿ƒåŠŸèƒ½è¯´æ˜

### 1. Publisher Confirm å¼‚æ­¥ç¡®è®¤

**å®ç°ä½ç½®**ï¼š`MessagePublisher.java`

#### å…³é”®ä»£ç ï¼š

```java
// é…ç½® Confirm å›è°ƒï¼ˆå¤„ç†å‘é€å¤±è´¥ï¼‰
rabbitTemplate.setConfirmCallback((correlationData, ack, cause) -> {
    if (ack) {
        log.info("âœ“ æ¶ˆæ¯å‘é€æˆåŠŸï¼æ¶ˆæ¯ID: {}", correlationData.getId());
    } else {
        log.error("âœ— æ¶ˆæ¯å‘é€å¤±è´¥ï¼æ¶ˆæ¯ID: {}, åŸå› : {}", 
                correlationData.getId(), cause);
        // âœ… æŒä¹…åŒ–å¤±è´¥æ¶ˆæ¯
        handleConfirmFailure(correlationData, cause);
    }
});

// é…ç½® Return å›è°ƒï¼ˆå¤„ç†è·¯ç”±å¤±è´¥ï¼‰
rabbitTemplate.setReturnsCallback(returned -> {
    log.error("âœ— æ¶ˆæ¯è·¯ç”±å¤±è´¥ï¼æ¶ˆæ¯: {}, äº¤æ¢æœº: {}, è·¯ç”±é”®: {}",
            returned.getMessage(),
            returned.getExchange(),
            returned.getRoutingKey());
    
    // âœ… æŒä¹…åŒ–å¤±è´¥æ¶ˆæ¯
    messageFailureService.saveFailedMessage(...);
    
    // âœ… å‘é€å‘Šè­¦
    sendAlert(returned);
});
```

#### ä¸‰å±‚é˜²æŠ¤æœºåˆ¶ï¼š

```
å‘é€æ¶ˆæ¯
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 1: Confirm å›è°ƒ        â”‚  æ¶ˆæ¯æ˜¯å¦åˆ°è¾¾ Exchange
â”‚ - å¤±è´¥åˆ™æŒä¹…åŒ–è®°å½•          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 2: Return å›è°ƒ         â”‚  æ¶ˆæ¯æ˜¯å¦æˆåŠŸè·¯ç”±
â”‚ - æŒä¹…åŒ– + å‘Šè­¦             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 3: Alternate Exchange  â”‚  RabbitMQ è‡ªåŠ¨å¤‡ä»½
â”‚ - è½¬å‘åˆ°å¤‡ç”¨é˜Ÿåˆ—           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. æ¶ˆæ¯å¤±è´¥å¤„ç†æœºåˆ¶ ğŸ”¥ 

**å®ç°ä½ç½®**ï¼š`MessageFailureService.java`

#### å¤±è´¥æ¶ˆæ¯ç®¡ç†ï¼š

```java
// ä¿å­˜å¤±è´¥æ¶ˆæ¯
String failedMessageId = messageFailureService.saveFailedMessage(
    messageBody,
    exchange,
    routingKey,
    replyCode,
    replyText,
    "ROUTING_FAILED"  // æˆ– "CONFIRM_FAILED"
);

// æŸ¥è¯¢å¤±è´¥æ¶ˆæ¯
List<FailedMessage> failedMessages = messageFailureService.getAllFailedMessages();

// é‡è¯•å¤±è´¥æ¶ˆæ¯
messageFailureService.markAsRetrying(messageId);
// ... é‡æ–°å‘é€æ¶ˆæ¯ ...
messageFailureService.markAsRetrySuccess(messageId);

// äººå·¥å¤„ç†
messageFailureService.markAsManuallyResolved(messageId, "admin", "å·²æ‰‹åŠ¨å¤„ç†");
```

#### æ¶ˆæ¯çŠ¶æ€æµè½¬ï¼š

```
PENDING â†’ RETRYING â†’ RETRY_SUCCESS
                  â†“
              RETRY_EXHAUSTED â†’ MANUALLY_RESOLVED
```

### 3. Alternate Exchangeï¼ˆå¤‡ç”¨äº¤æ¢æœºï¼‰ğŸ”¥

**å®ç°ä½ç½®**ï¼š`RabbitMQConfig.java`

#### é…ç½®ï¼š

```java
// ä¸»äº¤æ¢æœºé…ç½®å¤‡ç”¨äº¤æ¢æœº
@Bean
public DirectExchange demoExchange() {
    return ExchangeBuilder.directExchange(EXCHANGE_NAME)
            .durable(true)
            .alternate(ALTERNATE_EXCHANGE_NAME)  // å…³é”®é…ç½®
            .build();
}

// å¤‡ç”¨äº¤æ¢æœºï¼ˆFanout ç±»å‹ï¼‰
@Bean
public FanoutExchange alternateExchange() {
    return new FanoutExchange(ALTERNATE_EXCHANGE_NAME, true, false);
}
```

#### å·¥ä½œåŸç†ï¼š

1. ä¸»äº¤æ¢æœºæ— æ³•è·¯ç”±æ¶ˆæ¯æ—¶
2. æ¶ˆæ¯è‡ªåŠ¨è½¬å‘åˆ° Alternate Exchange
3. Alternate Exchange å¹¿æ’­åˆ°æ‰€æœ‰ç»‘å®šçš„é˜Ÿåˆ—
4. UnroutedMessageConsumer æ¶ˆè´¹å¤„ç†

### 4. Consumer å¼‚æ­¥ç¡®è®¤

**å®ç°ä½ç½®**ï¼š`ProductionMessageConsumer.java`

#### å…³é”®ä»£ç ï¼š

```java
@RabbitListener(queues = RabbitMQConfig.QUEUE_NAME)
public void receiveMessage(@Payload Message message,
                          Channel channel,
                          @Header(AmqpHeaders.DELIVERY_TAG) long deliveryTag) {
    
        try {
            // ä¸šåŠ¡å¤„ç†
            processMessage(message);
            
            // æ‰‹åŠ¨ç¡®è®¤æ¶ˆæ¯
            channel.basicAck(deliveryTag, false);
            log.info("âœ“ æ¶ˆæ¯å¤„ç†æˆåŠŸï¼Œå·²ç¡®è®¤");
            
        } catch (Exception e) {
            // æ‹’ç»æ¶ˆæ¯
            channel.basicNack(deliveryTag, false, false);
            log.error("âœ— æ¶ˆæ¯å¤„ç†å¤±è´¥ï¼Œå·²æ‹’ç»");
        }
}
```

#### å·¥ä½œæµç¨‹ï¼š

1. æ¶ˆè´¹è€…ä»é˜Ÿåˆ—æ¥æ”¶æ¶ˆæ¯ï¼ˆä½†ä¸è‡ªåŠ¨ç¡®è®¤ï¼‰
2. å¤„ç†æˆåŠŸï¼šè°ƒç”¨ `channel.basicAck()` æ‰‹åŠ¨ç¡®è®¤
3. å¤„ç†å¤±è´¥ï¼šè°ƒç”¨ `channel.basicNack()` æ‹’ç»æ¶ˆæ¯

## ğŸŒ API æ¥å£

### æ¶ˆæ¯å‘é€æ¥å£

#### 1. å‘é€å•æ¡æ¶ˆæ¯

```bash
curl -X POST http://localhost:8080/api/messages/send \
  -H "Content-Type: application/json" \
  -d '{"content": "Hello RabbitMQ"}'
```

#### 2. å‘é€æ¶ˆæ¯ï¼ˆå¸¦è‡ªåŠ¨é‡è¯•ï¼‰ğŸ”¥ **æ¨èä½¿ç”¨**

```bash
curl -X POST http://localhost:8080/api/messages/send-with-retry \
  -H "Content-Type: application/json" \
  -d '{"content": "Hello with Retry"}'
```

**ç‰¹æ€§ï¼š**
- âœ… è‡ªåŠ¨å¤„ç†ä¸´æ—¶ç½‘ç»œé—®é¢˜
- âœ… é‡è¯•3æ¬¡ï¼ŒæŒ‡æ•°é€€é¿ï¼ˆ1sã€2sã€4sï¼‰
- âœ… å¤±è´¥åè‡ªåŠ¨ä¿å­˜åˆ°å¤±è´¥è®°å½•

**å“åº”ç¤ºä¾‹ï¼ˆæˆåŠŸï¼‰ï¼š**
```json
{
  "success": true,
  "messageId": "abc-123-xyz",
  "message": "æ¶ˆæ¯å‘é€æˆåŠŸï¼ˆå¸¦è‡ªåŠ¨é‡è¯•ä¿æŠ¤ï¼‰"
}
```

**å“åº”ç¤ºä¾‹ï¼ˆå¤±è´¥ï¼‰ï¼š**
```json
{
  "success": false,
  "message": "æ¶ˆæ¯å‘é€å¤±è´¥ï¼ˆé‡è¯•3æ¬¡åä»ç„¶å¤±è´¥ï¼Œå·²ä¿å­˜åˆ°å¤±è´¥è®°å½•ï¼‰"
}
```

#### 3. å‘é€æ¶ˆæ¯å¹¶ç­‰å¾…ç¡®è®¤

```bash
curl -X POST http://localhost:8080/api/messages/send-with-confirm \
  -H "Content-Type: application/json" \
  -d '{"content": "Hello with Confirm"}'
```

#### 4. æ‰¹é‡å‘é€æ¶ˆæ¯

```bash
curl -X POST "http://localhost:8080/api/messages/send-batch?count=10"
```

#### 5. å‘é€é”™è¯¯æ¶ˆæ¯ï¼ˆæµ‹è¯• Consumer å¼‚å¸¸å¤„ç†ï¼‰

```bash
curl -X POST http://localhost:8080/api/messages/send-error
```

#### 6. å‘é€åˆ°é”™è¯¯è·¯ç”±é”®ï¼ˆæµ‹è¯• Return å›è°ƒï¼‰

```bash
curl -X POST http://localhost:8080/api/messages/send-wrong-routing
```

### å¤±è´¥æ¶ˆæ¯ç®¡ç†æ¥å£ ğŸ”¥ **NEW**

#### 7. è·å–æ‰€æœ‰å¤±è´¥æ¶ˆæ¯

```bash
curl http://localhost:8080/api/messages/failures
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "total": 5,
  "statistics": {
    "total": 5,
    "pending": 3,
    "retrying": 1,
    "retrySuccess": 1,
    "retryExhausted": 0,
    "manuallyResolved": 0
  },
  "messages": [...]
}
```

#### 7. è·å–å¾…å¤„ç†çš„å¤±è´¥æ¶ˆæ¯

```bash
curl http://localhost:8080/api/messages/failures/pending
```

#### 8. è·å–å¤±è´¥æ¶ˆæ¯ç»Ÿè®¡

```bash
curl http://localhost:8080/api/messages/failures/statistics
```

#### 9. é‡è¯•å•ä¸ªå¤±è´¥æ¶ˆæ¯

```bash
# æ›¿æ¢ {messageId} ä¸ºå®é™…çš„æ¶ˆæ¯ID
curl -X POST http://localhost:8080/api/messages/failures/{messageId}/retry
```

#### 10. æ‰¹é‡é‡è¯•å¤±è´¥æ¶ˆæ¯

```bash
curl -X POST "http://localhost:8080/api/messages/failures/retry-batch?limit=10"
```

#### 11. äººå·¥æ ‡è®°æ¶ˆæ¯ä¸ºå·²å¤„ç†

```bash
curl -X POST http://localhost:8080/api/messages/failures/{messageId}/resolve \
  -H "Content-Type: application/json" \
  -d '{
    "resolvedBy": "admin",
    "note": "å·²æ‰‹åŠ¨ä¿®å¤å¹¶é‡æ–°å‘é€"
  }'
```

#### 12. åˆ é™¤å¤±è´¥æ¶ˆæ¯è®°å½•

```bash
curl -X DELETE http://localhost:8080/api/messages/failures/{messageId}
```

## ğŸ§ª æµ‹è¯•åœºæ™¯

### åœºæ™¯ 1ï¼šæ­£å¸¸æ¶ˆæ¯æµç¨‹

1. å‘é€æ¶ˆæ¯
2. Publisher æ”¶åˆ° Confirm ç¡®è®¤
3. Consumer æ¥æ”¶å¹¶å¤„ç†æ¶ˆæ¯
4. Consumer æ‰‹åŠ¨ç¡®è®¤æ¶ˆæ¯

**æ—¥å¿—è¾“å‡ºç¤ºä¾‹**ï¼š

```
â†’ [Publisher] å‡†å¤‡å‘é€æ¶ˆæ¯: Hello RabbitMQ, ID: xxx
â†’ [Publisher] æ¶ˆæ¯å·²å‘é€ï¼Œç­‰å¾… Broker ç¡®è®¤...
âœ“ [Publisher Confirm] æ¶ˆæ¯å‘é€æˆåŠŸï¼æ¶ˆæ¯ID: xxx
â† [Consumer] æ”¶åˆ°æ¶ˆæ¯ #1: ID=xxx, Content=Hello RabbitMQ
â†’ [Consumer] å¼€å§‹å¤„ç†æ¶ˆæ¯: Hello RabbitMQ
â†’ [Consumer] æ¶ˆæ¯å¤„ç†å®Œæˆ: Hello RabbitMQ
âœ“ [Consumer] æ¶ˆæ¯å¤„ç†æˆåŠŸï¼Œå·²ç¡®è®¤: ID=xxx
```

### åœºæ™¯ 2ï¼šæ¶ˆæ¯å¤„ç†å¤±è´¥

å‘é€åŒ…å« "error" çš„æ¶ˆæ¯ï¼š

```bash
curl -X POST http://localhost:8080/api/messages/send-error
```

**æ—¥å¿—è¾“å‡º**ï¼š

```
âœ— [Consumer] æ¶ˆæ¯å¤„ç†å¤±è´¥: ID=xxx, Error=æ¶ˆæ¯å†…å®¹åŒ…å«é”™è¯¯æ ‡è¯†
âœ— [Consumer] æ¶ˆæ¯å·²æ‹’ç»ï¼Œä¸é‡æ–°å…¥é˜Ÿ: ID=xxx
```

### åœºæ™¯ 3ï¼šæ¶ˆæ¯è·¯ç”±å¤±è´¥ï¼ˆå®Œæ•´æµç¨‹ï¼‰ğŸ”¥ **NEW**

```bash
curl -X POST http://localhost:8080/api/messages/send-wrong-routing
```

**æ—¥å¿—è¾“å‡º**ï¼š

```
âœ“ [Publisher Confirm] æ¶ˆæ¯å‘é€æˆåŠŸï¼æ¶ˆæ¯ID: xxx
âœ— [Publisher Return] æ¶ˆæ¯è·¯ç”±å¤±è´¥ï¼
  äº¤æ¢æœº: demo.exchange
  è·¯ç”±é”®: wrong.routing.key
  å“åº”ç : 312
âœ“ å¤±è´¥æ¶ˆæ¯å·²æŒä¹…åŒ–ï¼ŒID: yyyï¼Œå¯é€šè¿‡ç®¡ç†æ¥å£é‡è¯•
âš  å‘Šè­¦ä¿¡æ¯: ã€RabbitMQå‘Šè­¦ã€‘æ¶ˆæ¯è·¯ç”±å¤±è´¥...
âš  [UnroutedConsumer] æ”¶åˆ°æœªè·¯ç”±æ¶ˆæ¯
  æ¶ˆæ¯å†…å®¹: {...}
  åŸå§‹äº¤æ¢æœº: demo.exchange
  åŸå§‹è·¯ç”±é”®: wrong.routing.key
```

**ä¸‰å±‚é˜²æŠ¤å·¥ä½œæµç¨‹**ï¼š
1. âœ… Return å›è°ƒè®°å½•å¤±è´¥æ¶ˆæ¯
2. âœ… æŒä¹…åŒ–åˆ° MessageFailureService
3. âœ… Alternate Exchange è‡ªåŠ¨è½¬å‘åˆ°å¤‡ç”¨é˜Ÿåˆ—
4. âœ… UnroutedMessageConsumer æ¶ˆè´¹å¤„ç†

### åœºæ™¯ 4ï¼šå¤±è´¥æ¶ˆæ¯ç®¡ç† ğŸ”¥ **NEW**

#### 4.1 æŸ¥çœ‹å¤±è´¥æ¶ˆæ¯

```bash
# æŸ¥çœ‹æ‰€æœ‰å¤±è´¥æ¶ˆæ¯
curl http://localhost:8080/api/messages/failures

# åªæŸ¥çœ‹å‘é€å¤±è´¥çš„æ¶ˆæ¯ï¼ˆè·¯ç”±å¤±è´¥ã€Confirmå¤±è´¥ï¼‰
curl http://localhost:8080/api/messages/failures/stage/PUBLISH

# åªæŸ¥çœ‹æ¶ˆè´¹å¤±è´¥çš„æ¶ˆæ¯ï¼ˆæ­»ä¿¡é˜Ÿåˆ—ã€ä¸šåŠ¡å¤„ç†å¤±è´¥ï¼‰
curl http://localhost:8080/api/messages/failures/stage/CONSUME

# æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯
curl http://localhost:8080/api/messages/failures/statistics
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "total": 150,
  "pending": 45,
  "retrying": 8,
  "retrySuccess": 72,
  "retryExhausted": 15,
  "manuallyResolved": 10,
  "publishFailures": 90,    // å‘é€é˜¶æ®µå¤±è´¥æ•°é‡
  "consumeFailures": 60     // æ¶ˆè´¹é˜¶æ®µå¤±è´¥æ•°é‡
}
```

**å¤±è´¥é˜¶æ®µè¯´æ˜**ï¼š

| é˜¶æ®µ | å€¼ | åŒ…å«çš„å¤±è´¥ç±»å‹ |
|------|-------|----------------|
| å‘é€é˜¶æ®µ | `PUBLISH` | è·¯ç”±å¤±è´¥ã€Confirmå¤±è´¥ |
| æ¶ˆè´¹é˜¶æ®µ | `CONSUME` | ä¸šåŠ¡å¤„ç†å¤±è´¥ã€æ­»ä¿¡æ¶ˆæ¯ã€æ¶ˆæ¯è¿‡æœŸã€é˜Ÿåˆ—æº¢å‡º |

#### 4.2 é‡è¯•å¤±è´¥æ¶ˆæ¯

```bash
# è·å–å¾…å¤„ç†çš„å¤±è´¥æ¶ˆæ¯
curl http://localhost:8080/api/messages/failures/pending

# é‡è¯•æŒ‡å®šæ¶ˆæ¯ï¼ˆä½¿ç”¨è¿”å›çš„æ¶ˆæ¯IDï¼‰
curl -X POST http://localhost:8080/api/messages/failures/abc-123/retry

# æ‰¹é‡é‡è¯•
curl -X POST "http://localhost:8080/api/messages/failures/retry-batch?limit=10"
```

#### 4.3 äººå·¥å¤„ç†

```bash
# æ ‡è®°ä¸ºå·²å¤„ç†
curl -X POST http://localhost:8080/api/messages/failures/abc-123/resolve \
  -H "Content-Type: application/json" \
  -d '{
    "resolvedBy": "admin",
    "note": "å·²ç¡®è®¤é—®é¢˜ï¼Œæ‰‹åŠ¨é‡æ–°å‘é€"
  }'
```

## âš™ï¸ é…ç½®è¯´æ˜

### application.yml å…³é”®é…ç½®

```yaml
spring:
  rabbitmq:
    # Publisher Confirm é…ç½®
    publisher-confirm-type: correlated  # å¯ç”¨å…³è”ç¡®è®¤ï¼ˆå¼‚æ­¥ï¼‰
    publisher-returns: true              # å¯ç”¨æ¶ˆæ¯è¿”å›å›è°ƒ
    template:
      mandatory: true                    # å¿…é¡»è·¯ç”±åˆ°é˜Ÿåˆ—ï¼ˆè§¦å‘ Return å›è°ƒï¼‰
    
    # Consumer é…ç½®
    listener:
      simple:
        acknowledge-mode: manual  # æ‰‹åŠ¨ç¡®è®¤æ¨¡å¼
        prefetch: 1              # æ¯æ¬¡åªæ‹‰å– 1 æ¡æ¶ˆæ¯
        concurrency: 3           # å¹¶å‘æ¶ˆè´¹è€…æ•°é‡
```

### RabbitMQ é…ç½®è¯¦è§£

#### 1. Publisher Confirm Type é€‰é¡¹

| é€‰é¡¹ | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|-----|------|---------|
| `none` | ç¦ç”¨ Publisher Confirm | ä¸å…³å¿ƒæ¶ˆæ¯æ˜¯å¦æˆåŠŸå‘é€ |
| `simple` | åŒæ­¥ç­‰å¾…ç¡®è®¤ï¼ˆé˜»å¡ï¼‰ | éœ€è¦ç«‹å³çŸ¥é“å‘é€ç»“æœ |
| `correlated` | å¼‚æ­¥ç¡®è®¤ï¼ˆæ¨èï¼‰| é«˜æ€§èƒ½åœºæ™¯ âœ… |

#### 2. Acknowledge Mode é€‰é¡¹

| æ¨¡å¼ | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|-----|------|---------|
| `auto` | è‡ªåŠ¨ç¡®è®¤ | æ¶ˆæ¯å¤„ç†ç®€å•ï¼Œä¸éœ€è¦é‡è¯• |
| `manual` | æ‰‹åŠ¨ç¡®è®¤ï¼ˆæ¨èï¼‰| éœ€è¦ç²¾ç¡®æ§åˆ¶æ¶ˆæ¯ç¡®è®¤ âœ… |
| `none` | ä¸ç¡®è®¤ | æµ‹è¯•æˆ–ç‰¹æ®Šåœºæ™¯ |

#### 3. Prefetch è¯´æ˜

| å€¼ | è¯´æ˜ | é€‚ç”¨åœºæ™¯ |
|---|------|---------|
| `1` | æ¯æ¬¡æ‹‰å– 1 æ¡ | æ¶ˆæ¯å¤„ç†è€—æ—¶é•¿ï¼Œéœ€è¦ä¸¥æ ¼é¡ºåº âœ… |
| `10-50` | æ¯æ¬¡æ‹‰å–å¤šæ¡ | æ¶ˆæ¯å¤„ç†å¿«ï¼Œæé«˜ååé‡ |
| `0` | æ— é™åˆ¶ | âŒ ä¸æ¨èï¼Œå¯èƒ½å¯¼è‡´å†…å­˜æº¢å‡º |

#### 4. Alternate Exchange é…ç½®

```java
// ä¸»äº¤æ¢æœºé…ç½®å¤‡ç”¨äº¤æ¢æœº
@Bean
public DirectExchange demoExchange() {
    return ExchangeBuilder.directExchange(EXCHANGE_NAME)
            .durable(true)
            .alternate(ALTERNATE_EXCHANGE_NAME)  // ğŸ”¥ å…³é”®é…ç½®
            .build();
}
```

**ä½œç”¨**ï¼šå½“æ¶ˆæ¯æ— æ³•è·¯ç”±æ—¶ï¼Œè‡ªåŠ¨è½¬å‘åˆ°å¤‡ç”¨äº¤æ¢æœºï¼Œå®ç° RabbitMQ å±‚é¢çš„æ¶ˆæ¯å¤‡ä»½ã€‚

## ğŸ“Š ç›‘æ§ä¸è°ƒè¯•

### 1. æŸ¥çœ‹ RabbitMQ ç®¡ç†ç•Œé¢

è®¿é—®ï¼šhttp://localhost:15672

- æŸ¥çœ‹é˜Ÿåˆ—æ¶ˆæ¯æ•°é‡
- ç›‘æ§æ¶ˆæ¯é€Ÿç‡
- æŸ¥çœ‹è¿æ¥å’Œé€šé“
- æŸ¥çœ‹ Alternate Exchange é…ç½®

**å…³é”®é˜Ÿåˆ—ï¼š**
- `demo.queue` - ä¸»ä¸šåŠ¡é˜Ÿåˆ—
- `dlx.queue` - æ­»ä¿¡é˜Ÿåˆ—
- `demo.retry.queue` - å»¶è¿Ÿé‡è¯•é˜Ÿåˆ—
- `unrouted.messages.queue` - æœªè·¯ç”±æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆNEWï¼‰

### 2. å¤±è´¥æ¶ˆæ¯ç›‘æ§ ğŸ”¥ **NEW**

```bash
# æŸ¥çœ‹å¤±è´¥æ¶ˆæ¯ç»Ÿè®¡
curl http://localhost:8080/api/messages/failures/statistics

# æŸ¥çœ‹å¾…å¤„ç†çš„å¤±è´¥æ¶ˆæ¯
curl http://localhost:8080/api/messages/failures/pending
```

**ç›‘æ§æŒ‡æ ‡ï¼š**
- `total` - å¤±è´¥æ¶ˆæ¯æ€»æ•°
- `pending` - å¾…å¤„ç†æ•°é‡
- `retrying` - é‡è¯•ä¸­æ•°é‡
- `retryExhausted` - é‡è¯•è€—å°½æ•°é‡ï¼ˆéœ€äººå·¥å¤„ç†ï¼‰

### 3. æŸ¥çœ‹åº”ç”¨æ—¥å¿—

```bash
tail -f logs/spring.log
```

### 4. å…³é”®æ—¥å¿—æ ‡è¯†

- `â†’` ï¼šå¼€å§‹æ“ä½œ
- `â†` ï¼šæ¥æ”¶æ¶ˆæ¯
- `âœ“` ï¼šæˆåŠŸ
- `âœ—` ï¼šå¤±è´¥
- `âŸ³` ï¼šé‡è¯•
- `âš ` ï¼šå‘Šè­¦ï¼ˆNEWï¼‰

## ğŸ”¥ å¸¸è§é—®é¢˜

### Q1: æ¶ˆæ¯å‘é€æˆåŠŸä½†æ²¡æœ‰æ¶ˆè´¹ï¼Ÿ

**åŸå› **ï¼šå¯èƒ½æ˜¯é˜Ÿåˆ—æœªæ­£ç¡®ç»‘å®šåˆ°äº¤æ¢æœºï¼Œæˆ–è·¯ç”±é”®ä¸åŒ¹é…ã€‚

**è§£å†³**ï¼š
1. æ£€æŸ¥ `RabbitMQConfig.java` ä¸­çš„ç»‘å®šå…³ç³»
2. æŸ¥çœ‹ RabbitMQ ç®¡ç†ç•Œé¢çš„ Bindings
3. æŸ¥çœ‹ `unrouted.messages.queue` æ˜¯å¦æœ‰æ¶ˆæ¯ï¼ˆè·¯ç”±å¤±è´¥ä¼šè¿›å…¥æ­¤é˜Ÿåˆ—ï¼‰

### Q2: Consumer ä¸ç¡®è®¤æ¶ˆæ¯ä¼šæ€æ ·ï¼Ÿ

**ç»“æœ**ï¼šæ¶ˆæ¯ä¼šä¸€ç›´ä¿æŒ "Unacked" çŠ¶æ€ï¼Œç›´åˆ°è¿æ¥æ–­å¼€ï¼Œç„¶åé‡æ–°å…¥é˜Ÿã€‚

### Q3: å¦‚ä½•å®ç°æ¶ˆæ¯é‡è¯•ï¼Ÿ

**æ–¹æ¡ˆ**ï¼š
1. ä½¿ç”¨ `basicNack(deliveryTag, false, true)` é‡æ–°å…¥é˜Ÿ
2. é…ç½®æ­»ä¿¡é˜Ÿåˆ—ï¼ˆDLXï¼‰
3. ä½¿ç”¨å»¶è¿Ÿé˜Ÿåˆ—æ’ä»¶
4. ğŸ”¥ **NEW**: ä½¿ç”¨å¤±è´¥æ¶ˆæ¯ç®¡ç†æ¥å£æ‰‹åŠ¨é‡è¯•

å‚è€ƒ `ProductionMessageConsumer.java` ä¸­çš„é‡è¯•ç¤ºä¾‹ã€‚

### Q4: Prefetch åº”è¯¥è®¾ç½®ä¸ºå¤šå°‘ï¼Ÿ

**å»ºè®®**ï¼š
- æ¶ˆæ¯å¤„ç†è€—æ—¶çŸ­ï¼šè®¾ç½®è¾ƒå¤§å€¼ï¼ˆå¦‚ 10-50ï¼‰
- æ¶ˆæ¯å¤„ç†è€—æ—¶é•¿ï¼šè®¾ç½®è¾ƒå°å€¼ï¼ˆå¦‚ 1-5ï¼‰
- éœ€è¦ä¸¥æ ¼é¡ºåºå¤„ç†ï¼šè®¾ç½®ä¸º 1

### Q5: æ¶ˆæ¯è·¯ç”±å¤±è´¥åä¼šä¸¢å¤±å—ï¼ŸğŸ”¥ **NEW**

**ç­”æ¡ˆ**ï¼šä¸ä¼šï¼æœ¬é¡¹ç›®å®ç°äº†ä¸‰å±‚é˜²æŠ¤æœºåˆ¶ï¼š

1. **Return å›è°ƒ**ï¼šæŒä¹…åŒ–å¤±è´¥æ¶ˆæ¯åˆ° `MessageFailureService`
2. **Alternate Exchange**ï¼šRabbitMQ è‡ªåŠ¨è½¬å‘åˆ°å¤‡ç”¨é˜Ÿåˆ—
3. **UnroutedMessageConsumer**ï¼šæ¶ˆè´¹å¹¶å¤„ç†å¤±è´¥æ¶ˆæ¯

å³ä½¿åº”ç”¨å´©æºƒï¼ŒAlternate Exchange ä¹Ÿä¼šä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±ã€‚

### Q6: å¦‚ä½•å¤„ç†å¤§é‡å¤±è´¥æ¶ˆæ¯ï¼ŸğŸ”¥ **NEW**

**æ–¹æ¡ˆ**ï¼š

1. **æ‰¹é‡é‡è¯•**ï¼š
```bash
curl -X POST "http://localhost:8080/api/messages/failures/retry-batch?limit=100"
```

2. **å®šæ—¶ä»»åŠ¡è‡ªåŠ¨é‡è¯•**ï¼ˆç”Ÿäº§ç¯å¢ƒå»ºè®®ï¼‰ï¼š
```java
@Scheduled(fixedRate = 60000)
public void autoRetryFailedMessages() {
    // è‡ªåŠ¨é‡è¯•å¾…å¤„ç†çš„å¤±è´¥æ¶ˆæ¯
}
```

3. **äººå·¥ä»‹å…¥å¤„ç†**ï¼š
```bash
curl -X POST http://localhost:8080/api/messages/failures/{id}/resolve \
  -d '{"resolvedBy": "admin", "note": "å·²æ‰‹åŠ¨å¤„ç†"}'
```

### Q7: å¤±è´¥æ¶ˆæ¯ä¿å­˜åœ¨å“ªé‡Œï¼ŸğŸ”¥ **NEW**

**å½“å‰å®ç°**ï¼šä¿å­˜åœ¨å†…å­˜ä¸­ï¼ˆ`ConcurrentHashMap`ï¼‰

**ç”Ÿäº§ç¯å¢ƒå»ºè®®**ï¼š
- ä½¿ç”¨æ•°æ®åº“æŒä¹…åŒ–ï¼ˆMySQLã€PostgreSQLï¼‰
- ä½¿ç”¨ Redisï¼ˆé«˜æ€§èƒ½åœºæ™¯ï¼‰
- å®šæœŸæ¸…ç†å·²å¤„ç†çš„æ¶ˆæ¯

è¯¦è§ï¼š[æ¶ˆæ¯å¤±è´¥å¤„ç†æ–‡æ¡£](docs/MESSAGE_FAILURE_HANDLING.md)

## ğŸ“š ç›¸å…³æ–‡æ¡£

### å®˜æ–¹æ–‡æ¡£

- [RabbitMQ å®˜æ–¹æ–‡æ¡£](https://www.rabbitmq.com/documentation.html)
- [Spring AMQP æ–‡æ¡£](https://docs.spring.io/spring-amqp/reference/)
- [Publisher Confirms](https://www.rabbitmq.com/confirms.html)
- [Consumer Acknowledgements](https://www.rabbitmq.com/confirms.html#consumer-acknowledgements)
- [Alternate Exchanges](https://www.rabbitmq.com/ae.html)

## ğŸ‘¤ ä½œè€…

CuiXin

## ğŸ¯ ä¸‹ä¸€æ­¥

### å¿«é€Ÿä½“éªŒ

1. **å¯åŠ¨é¡¹ç›®**ï¼š`mvn spring-boot:run`
2. **æµ‹è¯•è·¯ç”±å¤±è´¥**ï¼š
```bash
curl -X POST http://localhost:8080/api/messages/send-wrong-routing
```
3. **æŸ¥çœ‹å¤±è´¥æ¶ˆæ¯**ï¼š
```bash
curl http://localhost:8080/api/messages/failures
```
4. **é‡è¯•å¤±è´¥æ¶ˆæ¯**ï¼š
```bash
curl -X POST http://localhost:8080/api/messages/failures/{messageId}/retry
```

### æ·±å…¥å­¦ä¹ 

- ğŸ“– é˜…è¯» [æ¶ˆæ¯å¤±è´¥å¤„ç†æ–‡æ¡£](docs/MESSAGE_FAILURE_HANDLING.md)
- ğŸ“– æŸ¥çœ‹ [æ¶æ„è®¾è®¡æ–‡æ¡£](ARCHITECTURE.md)
- ğŸ“– å‚è€ƒ [ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æŒ‡å—](PRODUCTION.md)

### ç”Ÿäº§ç¯å¢ƒå‡†å¤‡

- [ ] å®ç°æ•°æ®åº“æŒä¹…åŒ–ï¼ˆæ›¿æ¢å†…å­˜å­˜å‚¨ï¼‰
- [ ] é›†æˆå‘Šè­¦ç³»ç»Ÿï¼ˆé’‰é’‰/ä¼ä¸šå¾®ä¿¡ï¼‰
- [ ] æ·»åŠ å®šæ—¶ä»»åŠ¡è‡ªåŠ¨é‡è¯•
- [ ] é…ç½® Grafana ç›‘æ§é¢æ¿
- [ ] æ·»åŠ æƒé™æ§åˆ¶

## ğŸ“ è®¸å¯

MIT License

---

**Happy Coding! ğŸ‰**

> ğŸ’¡ **æç¤º**ï¼šæœ¬é¡¹ç›®å®ç°äº†ç”Ÿäº§çº§åˆ«çš„æ¶ˆæ¯å¤±è´¥å¤„ç†æœºåˆ¶ï¼ŒåŒ…æ‹¬ä¸‰å±‚é˜²æŠ¤ã€è‡ªåŠ¨å¤‡ä»½ã€å¤±è´¥é‡è¯•ç­‰åŠŸèƒ½ã€‚è¯¦è§ [æ¶ˆæ¯å¤±è´¥å¤„ç†æ–‡æ¡£](docs/MESSAGE_FAILURE_HANDLING.md)ã€‚

